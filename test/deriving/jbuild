(executable
 ((name test)
  (flags (:standard -safe-string))
  (modules (test))
  (libraries (ppxlib))
  (preprocess (pps (ppxlib_metaquot)))))

(rule
 ((targets (fail01.output))
  (deps (test.exe fail01.ml))
  (action (with-outputs-to fail01.output
           (progn (bash "./test.exe -check fail01.ml || true"))))))

(rule
 ((targets (fail02.output))
  (deps (test.exe fail02.ml))
  (action (with-outputs-to fail02.output
           (progn (bash "./test.exe -check fail02.ml || true"))))))

(rule
 ((targets (pass01.output))
  (deps (test.exe pass01.ml))
  (action (with-outputs-to pass01.output
           (progn (bash "./test.exe -check pass01.ml || true"))))))

(alias
 ((name runtest)
  (action (progn
           (diff fail01.expected fail01.output)
           (diff fail02.expected fail02.output)
           (diff pass01.expected pass01.output)
           ))))

(jbuild_version 1)
